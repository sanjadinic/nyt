<!doctype html>
<html lang="en">
  <head>
    <title>NYT search articles</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
   <meta name="viewport" content="width=device-width">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  </head>
  <body>
    <h1>Search articles from New York Times</h1>
    <section id="search">
   <div id="root">
    <App>
        <selector>
           <form id="param">    
              <input id="month" type="number" min="1" max="12" value="1" placeholder="Enter month" required>    
              
              <input id="year" type="number" min="1851" max="2018" value="2018" placeholder="Enter year" required>    
              <button onclick="find()">Find</button>
            </form> 
          </selector>
                <Results/>
                <ArticleDetails/>
    </App>
        </div>
      </section>
  <script type="text/babel">

     class App extends React.Component {

        constructor(props){
          super(props);
          this.state = {'urls': []};
          this.onSuccess = this.onSuccess.bind(this);
        }

        onSuccess(responseData) {
          let urls = [];
          for(var i = 0; i < 20; i++) {
            const doc = responseData.response.docs[i];
            urls.push(doc.web_url);
          }
          this.setState({'urls': urls});
        }

    componentDidMount(){
    var url = "https://api.nytimes.com/svc/archive/v1/2016/1.json";
    url += '?' + $.param({
    'api-key': "581847de71484ddba4e5ae5eee1b92e4"
  });
           $.ajax({
              url: url,
              method: 'GET',
              
          }).done(this.onSuccess
).fail(function(err) {
  throw err;
});
    }

    render(){
        return (
            <div>
                <Results urls={this.state.urls}/>
                {/*<ArticleDetails />*/}
            </div>
        );

    }
}

function ArticleDetails(props){
    return (
        <div>
            {
              props.urls.map(
                (url, index) => <Url key={index} url={url}/>
              )
            }
        </div>
    );
}

function Results(props){
    return (
        <div>
            <ArticlePreview webUrl={props.urls[0]} />
        </div>
    )
}

class ArticlePreview extends React.Component {
/*
         componentDidMount(){
           $.ajax({
              url: 'https://api.linkpreview.net',
              method: 'GET',
              data: {
                  'key': "5a915cd51a38ad77da5d9698f24ff9055107e7a053d34",
                  'q': this.props.webUrl
              },
              success: this.onSuccess
          });
    }
*/
    render(){

      if(true) {
        return <p>{this.props.webUrl}</p>;
      }

        return  (
            <div>  
                <img src={this.state.img}/>
                <h3>{this.state.title}</h3>
                <p>{this.state.description}</p>
            </div>
        );
    }
}

function find(event){
    var month = document.getElementById('month');
    var year = document.getElementById('year')
    const root = document.getElementById('root');
    ReactDOM.render(<App />, root)
}

    </script>
    
  </body>
</html>
