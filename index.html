<!doctype html>
<html lang="en">
  <head>
    <title>NYT search articles</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
   <meta name="viewport" content="width=device-width">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  </head>
  <body>
    <h1>Search articles from New York Times</h1>
    <section id="search">
   <div id="root">
    <App>
        <selector>
           <form >    
              <input id="month" type="number" min="1" max="12" value="1" placeholder="Enter month" required>    
              
              <input id="year" type="number" min="1851" max="2018" value="2018" placeholder="Enter year" required>    
              <button onclick="find()">Find</button>
            </form> 
          </selector>
                <Results/>
                <ArticleDetails/>
    <App>
        </div>
      </section>
  <script type="text/babel">

     class App extends React.Component {

        constructor(props){
          super(props);
          this.state = {'urls': []};
          this.onSuccess = this.onSuccess.bind(this);
        }

        onSuccess(responseData) {
          let urls = [];
          for(var i = 0; i < 20; i++) {
            const doc = responseData.response.docs[i];
            urls.push(doc.web_url);
          }
          this.setState({'urls': urls});
        }

    componentDidMount(){
           $.ajax({
              url: 'https://developer.nytimes.com/archive_api.json',
              method: 'GET',
              data: {
                  'api-key': "581847de71484ddba4e5ae5eee1b92e4"
                  q_year: document.getElementById('year').value,
                  q_month: document.getElementById('month').value,
                  format: "jsonp",
                  callback: "jsonp_callback"
              },
              success: this.onSuccess
          });
    }

    render(){
        return (
            <div>
                <Results urls={this.state.urls}/>
                <ArticleDetails />
            </div>
        );

    }
}

function ArticleDetails(props){
    return (
        <div>
            {
              props.urls.map(
                (url, index) => <Url key={index} url={url}/>
              )
            }
        </div>
    );
}

function Results(props){
    return (
        <div>
            <ArticlePreview href={props.url} target="_blank">{props.url}</ArticlePreview>
        </div>
    )
}

class ArticlePreview extends React.Component {
         componentDidMount(){
           $.ajax({
              url: 'https://www.linkpreview.net/',
              method: 'GET',
              data: {
                  'api-key': "5a915cd51a38ad77da5d9698f24ff9055107e7a053d34"
              },
              success: this.onSuccess
          });
    }

    render(){
        return (
            <div>  
                <img src={props.img}/>
                <h3>{props.title}</h3>
                <p>{props.description}</p>
            </div>
        );
    }
}

function find(event){
    var month = document.getElementById('month');
    var year = document.getElementById('year')
    const root = document.getElementById('root');
    ReactDOM.render(<App />, root)
}

    </script>
    
  </body>
</html>
